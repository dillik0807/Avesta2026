# 💰 Инструкция: Управление ценами на товары

## 📋 Обзор новой функциональности

Теперь в системе добавлено **автоматическое управление ценами на товары**:
- Администратор может устанавливать цены несколько раз в день
- При создании расхода цена автоматически подставляется
- Ведется полная история изменения цен
- Цены привязаны к конкретным датам

## ⚙️ Как использовать

### 1. Установка цен (только для администратора)

1. Войдите как администратор
2. Перейдите в раздел **"Управление"**
3. Найдите блок **"💰 Управление ценами на товары"**
4. Заполните форму:
   - **Товар:** Выберите из списка существующих товаров
   - **Цена за тонну:** Введите цену (например, 1250.00)
   - **Дата действия:** Выберите дату (по умолчанию - сегодня)
5. Нажмите **"💰 Установить цену"**

### 2. Автоматическое заполнение цен при расходе

1. Перейдите в раздел **"Расход"**
2. Заполните обычные поля (дата, фирма, склад)
3. **Выберите товар** из списка
4. **Цена автоматически заполнится** актуальной ценой
5. Количество и общая сумма пересчитаются автоматически

## 📊 Возможности системы

### История цен
- Просмотр всех изменений цен по датам
- Фильтрация по конкретному товару
- Информация о том, кто и когда установил цену
- Возможность удаления ошибочных записей

### Текущие цены
- Отображение актуальных цен на сегодня
- Быстрый обзор всех товаров с ценами
- Цветовая индикация актуальных цен

### Управление данными
- Очистка старых цен (старше 30 дней)
- Удаление отдельных записей о ценах
- Автоматические уведомления об изменениях

## 🎯 Логика работы цен

### Приоритет цен:
1. **Цена на сегодня** - если установлена цена на текущую дату
2. **Последняя цена за день** - если в день было несколько изменений
3. **Последняя доступная цена** - из предыдущих дней

### Пример работы:
```
15.01.2025:
  09:00 - Пшеница: 1200.00 (установил admin)
  14:30 - Пшеница: 1250.00 (установил admin) ← будет использоваться

16.01.2025:
  Цена не установлена → используется 1250.00 от 15.01.2025
```

## 🔧 Интерфейс

### Форма установки цены:
```
┌─────────────────────────────────────────────────────────┐
│ Товар: [Пшеница ▼] Цена: [1250.00] Дата: [15.01.2025] │
│                    [💰 Установить цену]                 │
└─────────────────────────────────────────────────────────┘
```

### История цен:
```
┌──────────────────────────────────────────────────────────────┐
│ Дата       │ Время │ Товар   │ Цена      │ Установил │ Действия │
├──────────────────────────────────────────────────────────────┤
│ 15.01.2025 │ 14:30 │ Пшеница │ 1,250.00  │ admin     │ 🗑️ Удалить │
│ 15.01.2025 │ 09:00 │ Пшеница │ 1,200.00  │ admin     │ 🗑️ Удалить │
│ 14.01.2025 │ 16:45 │ Ячмень  │ 980.00    │ admin     │ 🗑️ Удалить │
└──────────────────────────────────────────────────────────────┘
```

### Текущие цены:
```
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│ Пшеница         │ │ Ячмень          │ │ Кукуруза        │
│ 1,250.00 за тонну│ │ 980.00 за тонну │ │ 1,100.00 за тонну│
│ Актуальная цена │ │ Актуальная цена │ │ Актуальная цена │
└─────────────────┘ └─────────────────┘ └─────────────────┘
```

## 🚀 Преимущества

1. **Автоматизация:** Завсклады не вводят цены вручную
2. **Актуальность:** Цены всегда соответствуют текущему дню
3. **Гибкость:** Можно менять цены несколько раз в день
4. **Контроль:** Полная история изменений с указанием автора
5. **Безопасность:** Только администратор может устанавливать цены

## ⚠️ Важные моменты

- **Права доступа:** Устанавливать цены может только администратор
- **Автозаполнение:** Работает только при выборе товара из списка
- **Пересчет:** При изменении цены автоматически пересчитывается общая сумма
- **Уведомления:** Система показывает уведомления об автозаполнении цен
- **Резервное копирование:** Цены сохраняются вместе с остальными данными

## 🧪 Тестовый сценарий

1. **Войдите как администратор**
2. **Создайте товары:** Пшеница, Ячмень
3. **Установите цены:**
   - Пшеница: 1250.00 на сегодня
   - Ячмень: 980.00 на сегодня
4. **Войдите как завсклад**
5. **Создайте расход:**
   - Выберите товар "Пшеница"
   - Цена должна автоматически заполниться: 1250.00
   - Введите количество: 40 (= 2 тонны)
   - Общая сумма: 2500.00 (2 × 1250.00)

## 📱 Мобильная версия

Все функции управления ценами полностью адаптированы для мобильных устройств:
- Удобные формы ввода
- Адаптивные таблицы
- Сенсорное управление
- Уведомления

---

**Готово!** Теперь ваша система автоматически управляет ценами на товары! 🎉

## 🔄 Структура данных

Цены сохраняются в следующем формате:
```javascript
productPrices: {
  "2025-01-15": {
    "Пшеница": [
      { price: 1200.00, time: "09:00:15", user: "admin", timestamp: 1737799215000 },
      { price: 1250.00, time: "14:30:45", user: "admin", timestamp: 1737818445000 }
    ],
    "Ячмень": [
      { price: 980.00, time: "10:15:30", user: "admin", timestamp: 1737803730000 }
    ]
  },
  "2025-01-16": {
    // цены на следующий день
  }
}
```