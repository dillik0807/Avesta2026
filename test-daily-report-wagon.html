<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –æ—Ç—á–µ—Ç–∞ –∑–∞ –¥–µ–Ω—å —Å –∫–æ–ª–æ–Ω–∫–æ–π "–í–∞–≥–æ–Ω"</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">üöõ –¢–µ—Å—Ç –æ—Ç—á–µ—Ç–∞ –∑–∞ –¥–µ–Ω—å —Å –∫–æ–ª–æ–Ω–∫–æ–π "–í–∞–≥–æ–Ω"</h1>
        
        <div class="bg-white p-6 rounded-lg shadow mb-6">
            <h2 class="text-xl font-bold mb-4">üìã –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π</h2>
            <div class="bg-green-50 border border-green-200 rounded p-4">
                <p class="text-green-800">
                    <strong>–î–æ–±–∞–≤–ª–µ–Ω–æ:</strong> –ö–æ–ª–æ–Ω–∫–∞ "–í–∞–≥–æ–Ω" –≤ –æ—Ç—á–µ—Ç –∑–∞ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å –≤ —Ä–∞–∑–¥–µ–ª–µ "–ü—Ä–∏—Ö–æ–¥ —Ç–æ–≤–∞—Ä–æ–≤"
                </p>
                <ul class="mt-2 text-green-700 text-sm list-disc list-inside">
                    <li>–ö–æ–ª–æ–Ω–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –º–µ–∂–¥—É "–î–∞—Ç–∞" –∏ "–§–∏—Ä–º–∞"</li>
                    <li>–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–æ–º–µ—Ä –≤–∞–≥–æ–Ω–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏—Ö–æ–¥–∞</li>
                    <li>–ï—Å–ª–∏ –≤–∞–≥–æ–Ω –Ω–µ —É–∫–∞–∑–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è "-"</li>
                    <li>–û–±–Ω–æ–≤–ª–µ–Ω —ç–∫—Å–ø–æ—Ä—Ç –≤ Excel</li>
                </ul>
            </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow mb-6">
            <h2 class="text-xl font-bold mb-4">üß™ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
            <button id="generateTestReport" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mb-4">
                –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –æ—Ç—á–µ—Ç
            </button>
            <button id="exportTestReport" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 mb-4 ml-2">
                –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
            </button>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ—Ç—á–µ—Ç–∞ -->
        <div id="reportContainer" class="bg-white rounded-lg shadow p-6 hidden">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">üìÖ –û—Ç—á–µ—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è</h3>
                <button id="closeReport" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div id="reportContent">
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Ç—á–µ—Ç–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –∑–¥–µ—Å—å -->
            </div>
        </div>
    </div>

    <script>
        // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –≤–∞–≥–æ–Ω–∞–º–∏
        const testData = {
            date: new Date().toISOString().split('T')[0],
            income: [
                {
                    date: new Date().toISOString().split('T')[0],
                    wagon: "–í-12345",
                    company: "–û–û–û –°—Ç—Ä–æ–π-–ú–∞—Ç–µ—Ä–∏–∞–ª—ã",
                    warehouse: "–°–∫–ª–∞–¥ –°—É–≥–¥-1", 
                    product: "–¶–µ–º–µ–Ω—Ç –ú400",
                    qtyDoc: 100,
                    qtyFact: 98,
                    difference: -2,
                    weightTons: 4.9,
                    user: "admin"
                },
                {
                    date: new Date().toISOString().split('T')[0],
                    wagon: "–í-67890",
                    company: "–ò–ü –ò–≤–∞–Ω–æ–≤ –ê.–°.",
                    warehouse: "–°–∫–ª–∞–¥ –•–∏—Å–æ—Ä-–ê",
                    product: "–ü–µ—Å–æ–∫ —Ä–µ—á–Ω–æ–π",
                    qtyDoc: 50,
                    qtyFact: 52,
                    difference: 2,
                    weightTons: 2.6,
                    user: "tillo"
                },
                {
                    date: new Date().toISOString().split('T')[0],
                    wagon: "", // –ü—É—Å—Ç–æ–π –≤–∞–≥–æ–Ω –¥–ª—è —Ç–µ—Å—Ç–∞
                    company: "–¢–î –°—Ç—Ä–æ–π–∫–æ–º",
                    warehouse: "–°–∫–ª–∞–¥ –°—É–≥–¥-2",
                    product: "–©–µ–±–µ–Ω—å 5-20",
                    qtyDoc: 75,
                    qtyFact: 75,
                    difference: 0,
                    weightTons: 3.75,
                    user: "admin"
                }
            ],
            expense: [
                {
                    date: new Date().toISOString().split('T')[0],
                    company: "–û–û–û –°—Ç—Ä–æ–π-–ú–∞—Ç–µ—Ä–∏–∞–ª—ã",
                    warehouse: "–°–∫–ª–∞–¥ –°—É–≥–¥-1",
                    client: "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
                    product: "–¶–µ–º–µ–Ω—Ç –ú400",
                    quantity: 20,
                    tons: 1.0,
                    price: 1250.00,
                    total: 1250.00,
                    user: "admin"
                }
            ]
        };

        // –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ HTML –æ—Ç—á–µ—Ç–∞ (–∫–æ–ø–∏—è –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–π –∫–æ–ª–æ–Ω–∫–æ–π "–í–∞–≥–æ–Ω")
        function generateDailyReportHtml(data) {
            const formatDate = (dateStr) => {
                const date = new Date(dateStr);
                return date.toLocaleDateString('ru-RU', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
            };

            let html = `
                <div class="daily-report">
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">–û—Ç—á–µ—Ç –∑–∞ ${formatDate(data.date)}</h2>
                        <p class="text-gray-600">–ü—Ä–∏—Ö–æ–¥ –∏ —Ä–∞—Å—Ö–æ–¥ —Ç–æ–≤–∞—Ä–æ–≤</p>
                    </div>
            `;

            // –ü–†–ò–•–û–î
            html += `
                <div class="mb-8">
                    <h3 class="text-xl font-semibold mb-4 text-green-700 border-b-2 border-green-200 pb-2">
                        üì¶ –ü–†–ò–•–û–î –¢–û–í–ê–†–û–í
                    </h3>
            `;

            if (data.income.length > 0) {
                html += `
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse border border-gray-300">
                            <thead class="bg-green-50">
                                <tr>
                                    <th class="border border-gray-300 p-2 text-left">–î–∞—Ç–∞</th>
                                    <th class="border border-gray-300 p-2 text-left">–í–∞–≥–æ–Ω</th>
                                    <th class="border border-gray-300 p-2 text-left">–§–∏—Ä–º–∞</th>
                                    <th class="border border-gray-300 p-2 text-left">–°–∫–ª–∞–¥</th>
                                    <th class="border border-gray-300 p-2 text-left">–¢–æ–≤–∞—Ä</th>
                                    <th class="border border-gray-300 p-2 text-center">–ö–æ–ª-–≤–æ –ø–æ –¥–æ–∫</th>
                                    <th class="border border-gray-300 p-2 text-center">–ö–æ–ª-–≤–æ –ø–æ —Ñ–∞–∫—Ç</th>
                                    <th class="border border-gray-300 p-2 text-center">–†–∞–∑–Ω–∏—Ü–∞</th>
                                    <th class="border border-gray-300 p-2 text-center">–í–µ—Å —Ç–æ–Ω–Ω –ø–æ —Ñ–∞–∫—Ç</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                let totalDoc = 0, totalFact = 0, totalDiff = 0, totalWeight = 0;

                data.income.forEach(item => {
                    totalDoc += item.qtyDoc || 0;
                    totalFact += item.qtyFact || 0;
                    totalDiff += item.difference || 0;
                    totalWeight += item.weightTons || 0;

                    html += `
                        <tr class="hover:bg-gray-50">
                            <td class="border border-gray-300 p-2">${formatDate(item.date)}</td>
                            <td class="border border-gray-300 p-2">${item.wagon || '-'}</td>
                            <td class="border border-gray-300 p-2">${item.company}</td>
                            <td class="border border-gray-300 p-2">${item.warehouse}</td>
                            <td class="border border-gray-300 p-2">${item.product}</td>
                            <td class="border border-gray-300 p-2 text-center">${item.qtyDoc || 0}</td>
                            <td class="border border-gray-300 p-2 text-center">${item.qtyFact || 0}</td>
                            <td class="border border-gray-300 p-2 text-center ${(item.difference || 0) >= 0 ? 'text-green-600' : 'text-red-600'}">${item.difference || 0}</td>
                            <td class="border border-gray-300 p-2 text-center">${(item.weightTons || 0).toFixed(2)}</td>
                        </tr>
                    `;
                });

                // –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–ª—è –ø—Ä–∏—Ö–æ–¥–∞
                html += `
                        <tr class="bg-green-100 font-bold">
                            <td colspan="5" class="border border-gray-300 p-2 text-right">–ò–¢–û–ì–û –ü–†–ò–•–û–î:</td>
                            <td class="border border-gray-300 p-2 text-center">${totalDoc}</td>
                            <td class="border border-gray-300 p-2 text-center">${totalFact}</td>
                            <td class="border border-gray-300 p-2 text-center ${totalDiff >= 0 ? 'text-green-600' : 'text-red-600'}">${totalDiff}</td>
                            <td class="border border-gray-300 p-2 text-center">${totalWeight.toFixed(2)}</td>
                        </tr>
                    </tbody>
                </table>
                </div>
            `;
            } else {
                html += `<p class="text-gray-500 italic">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–∏—Ö–æ–¥–µ —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å.</p>`;
            }

            html += `</div>`;

            // –†–ê–°–•–û–î (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è —Ç–µ—Å—Ç–∞)
            html += `
                <div class="mb-8">
                    <h3 class="text-xl font-semibold mb-4 text-red-700 border-b-2 border-red-200 pb-2">
                        üì§ –†–ê–°–•–û–î –¢–û–í–ê–†–û–í
                    </h3>
            `;

            if (data.expense.length > 0) {
                html += `<p class="text-gray-600">–ó–∞–ø–∏—Å–µ–π —Ä–∞—Å—Ö–æ–¥–∞: ${data.expense.length}</p>`;
            } else {
                html += `<p class="text-gray-500 italic">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ä–∞—Å—Ö–æ–¥–µ —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å.</p>`;
            }

            html += `</div></div>`;

            return html;
        }

        // –§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ Excel
        function exportTestReportToExcel() {
            const workbook = {
                SheetNames: ['–ü—Ä–∏—Ö–æ–¥'],
                Sheets: {}
            };

            // –õ–∏—Å—Ç: –ü—Ä–∏—Ö–æ–¥ —Ç–æ–≤–∞—Ä–æ–≤ —Å –∫–æ–ª–æ–Ω–∫–æ–π "–í–∞–≥–æ–Ω"
            const incomeData = [
                ['–î–∞—Ç–∞', '–í–∞–≥–æ–Ω', '–§–∏—Ä–º–∞', '–°–∫–ª–∞–¥', '–¢–æ–≤–∞—Ä', '–ö–æ–ª-–≤–æ –ø–æ –¥–æ–∫', '–ö–æ–ª-–≤–æ –ø–æ —Ñ–∞–∫—Ç', '–†–∞–∑–Ω–∏—Ü–∞', '–í–µ—Å —Ç–æ–Ω–Ω –ø–æ —Ñ–∞–∫—Ç', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å']
            ];

            let totalDoc = 0, totalFact = 0, totalDiff = 0, totalWeight = 0;

            testData.income.forEach(item => {
                totalDoc += item.qtyDoc || 0;
                totalFact += item.qtyFact || 0;
                totalDiff += item.difference || 0;
                totalWeight += item.weightTons || 0;

                incomeData.push([
                    new Date(item.date).toLocaleDateString('ru-RU'),
                    item.wagon || '',
                    item.company || '',
                    item.warehouse || '',
                    item.product || '',
                    item.qtyDoc || 0,
                    item.qtyFact || 0,
                    item.difference || 0,
                    (item.weightTons || 0).toFixed(2),
                    item.user || ''
                ]);
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç—Ä–æ–∫—É
            incomeData.push([
                '–ò–¢–û–ì–û:',
                '',
                '',
                '',
                '',
                totalDoc,
                totalFact,
                totalDiff,
                totalWeight.toFixed(2),
                ''
            ]);

            workbook.Sheets['–ü—Ä–∏—Ö–æ–¥'] = XLSX.utils.aoa_to_sheet(incomeData);

            const fileName = `–¢–µ—Å—Ç_–æ—Ç—á–µ—Ç_—Å_–≤–∞–≥–æ–Ω–∞–º–∏_${new Date().toLocaleDateString('ru-RU').replace(/\./g, '-')}.xlsx`;
            XLSX.writeFile(workbook, fileName);

            alert('–¢–µ—Å—Ç–æ–≤—ã–π –æ—Ç—á–µ—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ Excel: ' + fileName);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.getElementById('generateTestReport').addEventListener('click', function() {
            const reportHtml = generateDailyReportHtml(testData);
            document.getElementById('reportContent').innerHTML = reportHtml;
            document.getElementById('reportContainer').classList.remove('hidden');
        });

        document.getElementById('exportTestReport').addEventListener('click', function() {
            exportTestReportToExcel();
        });

        document.getElementById('closeReport').addEventListener('click', function() {
            document.getElementById('reportContainer').classList.add('hidden');
        });
    </script>
</body>
</html>