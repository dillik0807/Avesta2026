# 🏭 Инструкция: Установка цен по группам складов

## 📋 Новая функциональность

Теперь система поддерживает **установку разных цен для разных групп складов**:
- Можно устанавливать отдельные цены для каждой группы складов (Сугд, Хисор, Душанбе и т.д.)
- Глобальные цены для всех складов одновременно
- Автоматический выбор правильной цены в зависимости от выбранного склада
- Приоритет: цена группы → глобальная цена

## ⚙️ Как использовать

### 1. Установка цен по группам (администратор)

1. **Войдите как администратор**
2. **Перейдите в "Управление"**
3. **Найдите "💰 Управление ценами на товары"**
4. **Заполните форму:**
   - **Товар:** Выберите товар
   - **Группа складов:** Выберите конкретную группу или "🌍 Все склады"
   - **Цена за тонну:** Введите цену
   - **Дата действия:** Выберите дату
5. **Нажмите "💰 Установить цену"**

### 2. Автоматическое заполнение при расходе

1. **Перейдите в "Расход"**
2. **Выберите склад** (например, "Склад Сугд-1")
3. **Выберите товар** (например, "Пшеница")
4. **Цена автоматически заполнится** в зависимости от группы склада

## 🎯 Логика работы цен

### Приоритет выбора цены:
1. **Цена для конкретной группы** - если установлена цена для группы склада
2. **Глобальная цена** - если нет цены для группы, используется общая цена
3. **Последняя доступная цена** - из предыдущих дней

### Пример работы:
```
Товар: Пшеница, Дата: 15.01.2025

Установленные цены:
- Группа "Сугд": 1200.00 за тонну
- Группа "Хисор": 1300.00 за тонну  
- Все склады: 1250.00 за тонну (глобальная)

Результат при выборе склада:
- Склад Сугд-1 (группа: Сугд) → 1200.00
- Склад Хисор-А (группа: Хисор) → 1300.00
- Склад Душанбе-1 (группа: Душанбе) → 1250.00 (глобальная)
```

## 🔧 Интерфейс

### Форма установки цены:
```
┌─────────────────────────────────────────────────────────────────────┐
│ Товар: [Пшеница ▼] Группа: [📍 Сугд ▼] Цена: [1200.00] Дата: [...] │
│                           [💰 Установить цену]                      │
└─────────────────────────────────────────────────────────────────────┘
```

### Варианты групп:
- **🌍 Все склады (глобальная цена)** - применяется ко всем складам
- **📍 Сугд** - только для складов группы "Сугд"
- **📍 Хисор** - только для складов группы "Хисор"
- **📍 Душанбе** - только для складов группы "Душанбе"

### История цен:
```
┌────────────────────────────────────────────────────────────────────────┐
│ Дата       │ Время │ Товар   │ Группа складов │ Цена    │ Установил │ │
├────────────────────────────────────────────────────────────────────────┤
│ 15.01.2025 │ 14:30 │ Пшеница │ 📍 Сугд        │ 1200.00 │ admin     │ │
│ 15.01.2025 │ 14:25 │ Пшеница │ 📍 Хисор       │ 1300.00 │ admin     │ │
│ 15.01.2025 │ 09:00 │ Пшеница │ 🌍 Все склады  │ 1250.00 │ admin     │ │
└────────────────────────────────────────────────────────────────────────┘
```

### Текущие цены:
```
┌─────────────────────┐ ┌─────────────────────┐ ┌─────────────────────┐
│ Пшеница             │ │ Пшеница             │ │ Пшеница             │
│ 1200.00 за тонну    │ │ 1300.00 за тонну    │ │ 1250.00 за тонну    │
│ 📍 Группа: Сугд     │ │ 📍 Группа: Хисор    │ │ 🌍 Глобальная цена  │
└─────────────────────┘ └─────────────────────┘ └─────────────────────┘
```

## 🚀 Преимущества

1. **Гибкость ценообразования:** Разные цены для разных регионов
2. **Автоматизация:** Правильная цена подставляется автоматически
3. **Контроль:** Полная история цен по группам
4. **Удобство:** Завсклады не думают о ценах - система все делает сама
5. **Масштабируемость:** Легко добавлять новые группы складов

## 🧪 Тестовый сценарий

### Подготовка:
1. **Создайте группы складов:** Сугд, Хисор
2. **Создайте склады:**
   - Склад Сугд-1 (группа: Сугд)
   - Склад Хисор-А (группа: Хисор)
3. **Создайте товар:** Пшеница

### Установка цен:
1. **Войдите как администратор**
2. **Установите цены:**
   - Пшеница → Группа "Сугд" → 1200.00
   - Пшеница → Группа "Хисор" → 1300.00
   - Пшеница → Все склады → 1250.00

### Тестирование автозаполнения:
1. **Войдите как завсклад**
2. **Создайте расход:**
   - Склад: "Склад Сугд-1" → Товар: "Пшеница" → Цена: **1200.00** ✅
   - Склад: "Склад Хисор-А" → Товар: "Пшеница" → Цена: **1300.00** ✅

## ⚠️ Важные моменты

### Обратная совместимость:
- Старые цены (без групп) автоматически считаются глобальными
- Существующие данные продолжают работать без изменений

### Права доступа:
- **Администратор:** Устанавливает цены для всех групп
- **Завсклад:** Видит только цены своих групп складов
- **Автозаполнение:** Работает для всех ролей

### Логика выбора:
- При выборе товара **без** выбора склада → глобальная цена
- При выборе товара **после** выбора склада → цена группы склада
- При смене склада → цена автоматически обновляется

## 🔄 Структура данных

Новая структура хранения цен:
```javascript
productPrices: {
  "2025-01-15": {
    "Пшеница": {
      "Сугд": [
        { price: 1200.00, time: "14:30", user: "admin", timestamp: 123456 }
      ],
      "Хисор": [
        { price: 1300.00, time: "14:25", user: "admin", timestamp: 123455 }
      ],
      "ALL": [
        { price: 1250.00, time: "09:00", user: "admin", timestamp: 123400 }
      ]
    }
  }
}
```

## 📱 Мобильная версия

Все функции полностью адаптированы для мобильных устройств:
- Удобные выпадающие списки
- Адаптивные формы
- Цветовая индикация групп
- Сенсорное управление

---

**Готово!** Теперь ваша система поддерживает гибкое ценообразование по группам складов! 🎉

## 🎨 Цветовая схема

- **🌍 Глобальные цены:** Синий цвет (для всех складов)
- **📍 Групповые цены:** Фиолетовый цвет (для конкретных групп)
- **✅ Автозаполнение:** Зеленые уведомления с указанием источника цены

Система стала еще более мощной и гибкой! 🚀